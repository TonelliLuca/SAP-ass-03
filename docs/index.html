<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Assignment 03 Report</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="book">
<div id="header">
<h1>Assignment 03 Report</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>University of Bologna</p>
</div>
<div class="paragraph">
<p>Master Degree in Computer Science and Engineering - Software Architecture and Platforms</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="normalize">Luca Tonelli</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="normalize">0001126379</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="normalize">luca.tonelli11@studio.unibo.it</span></p></td>
</tr>
</tbody>
</table>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_obiettivi_e_descrizione">1. Obiettivi e Descrizione</a></li>
<li><a href="#_package_p_1_microservizi_event_driven">2. Package P-1: Microservizi Event-Driven</a>
<ul class="sectlevel2">
<li><a href="#_visione_architetturale">2.1. Visione Architetturale</a></li>
<li><a href="#_dettaglio_dei_microservizi">2.2. Dettaglio dei microservizi</a></li>
<li><a href="#_scelte_architetturali_e_organizzazione_dei_topic_kafka">2.3. Scelte architetturali e organizzazione dei topic Kafka</a></li>
</ul>
</li>
<li><a href="#_package_p_2_deployment_su_kubernetes">3. Package P-2: Deployment su Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#_obiettivo">3.1. Obiettivo</a></li>
<li><a href="#_strategia_di_deployment">3.2. Strategia di Deployment</a></li>
<li><a href="#_componenti_infrastrutturali_distribuiti">3.3. Componenti Infrastrutturali Distribuiti</a></li>
<li><a href="#_microservizi_applicativi">3.4. Microservizi Applicativi</a></li>
<li><a href="#_configurazione_centralizzata">3.5. Configurazione Centralizzata</a></li>
<li><a href="#_esecuzione_del_deployment">3.6. Esecuzione del Deployment</a></li>
<li><a href="#_accesso_al_sistema">3.7. Accesso al Sistema</a></li>
<li><a href="#_pipeline_di_lancio_completa">3.8. Pipeline di Lancio Completa</a></li>
</ul>
</li>
<li><a href="#_package_p_3_introduzione_di_a_bike_station_e_digital_twin">4. Package P-3: Introduzione di A-Bike, Station e Digital Twin</a>
<ul class="sectlevel2">
<li><a href="#_estensione_del_domain_driven_design_a_bike_station_e_digital_twin">4.1. Estensione del Domain-Driven Design: A-Bike, Station e Digital Twin</a></li>
<li><a href="#_use_case_diagrams">4.2. Use-Case diagrams</a></li>
<li><a href="#_domain_storytelling">4.3. Domain storytelling</a></li>
<li><a href="#_bounded_context">4.4. Bounded Context</a></li>
<li><a href="#_domain_model">4.5. Domain model</a></li>
<li><a href="#_implementazione_dei_microservizi">4.6. Implementazione dei microservizi</a></li>
<li><a href="#_organizzazione_topic_kafka_e_nuovo_flusso_di_comunicazione">4.7. Organizzazione topic Kafka e nuovo flusso di comunicazione</a></li>
<li><a href="#_integrazione_eclipse_ditto_digital_twin_adapter">4.8. Integrazione Eclipse Ditto &amp; Digital Twin Adapter</a></li>
</ul>
</li>
<li><a href="#_conclusioni">5. Conclusioni</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_obiettivi_e_descrizione">1. Obiettivi e Descrizione</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il presente assignment ha l’obiettivo di estendere e trasformare il sistema di bike sharing sviluppato negli assignment precedenti, applicando i principi dell’architettura a microservizi basata su event-driven design. L’elaborato si concentra sull’evoluzione di un progetto già modellato secondo Domain Driven Design (DDD), adottando un’architettura distribuita in grado di favorire scalabilità, resilienza e indipendenza dei singoli componenti.</p>
</div>
<div class="paragraph">
<p>A partire dall’analisi di dominio e dal modello già sviluppato nell’Assignment 2 – di cui si rimanda al report ufficiale disponibile all’indirizzo <a href="https://github.com/TonelliLuca/SAP-ass-02/blob/main/doc/asciidoc/doc/assets/docs/report.pdf" class="bare">https://github.com/TonelliLuca/SAP-ass-02/blob/main/doc/asciidoc/doc/assets/docs/report.pdf</a> – il lavoro si focalizza sulle attività di refactoring architetturale e sulle scelte progettuali che abilitano la comunicazione asincrona tra servizi, la suddivisione delle responsabilità, e la gestione delle interazioni tramite eventi di dominio.</p>
</div>
<div class="paragraph">
<p>Per rispondere in modo strutturato ai requisiti dell’Assignment 3, il progetto è stato suddiviso in tre package principali:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>p-1</code>: contiene la trasformazione del sistema in una soluzione a microservizi event-driven, mantenendo la coerenza con il dominio originale.</p>
</li>
<li>
<p><code>p-2</code>: Definisce un deployment del sistema sviluppato nel punto precedente utilizzando Kubernetes.</p>
</li>
<li>
<p><code>p-3</code>: Estende le funzionalità sviluppate in p-1 introducendo la gestione delle a-bike, delle stazioni e una prima integrazione di digital twin, in linea con le direttive dell’assignment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questa organizzazione riflette la volontà di separare logicamente le diverse fasi e aree di sviluppo, facilitando la leggibilità, la manutenzione e la tracciabilità degli avanzamenti progettuali.</p>
</div>
<div class="paragraph">
<p>Nel seguito del report verranno dettagliate le scelte architetturali, le principali differenze rispetto alla soluzione originaria, e le motivazioni a supporto delle strategie adottate.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_package_p_1_microservizi_event_driven">2. Package P-1: Microservizi Event-Driven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il package P-1 rappresenta il nucleo centrale del progetto, fornendo un&#8217;implementazione completa dell&#8217;applicazione E-Bike tramite un&#8217;architettura basata su microservizi event-driven. La soluzione si basa sulla soluzione proposta dell&#8217;<a href="https://github.com/TonelliLuca/SAP-ass-02">Assignment 02</a>.</p>
</div>
<div class="sect2">
<h3 id="_visione_architetturale">2.1. Visione Architetturale</h3>
<div class="paragraph">
<p>L&#8217;architettura si basa sulla comunicazione asincrona tra microservizi tramite eventi, con Apache Kafka utilizzato come broker centrale. Ogni microservizio è stato progettato secondo il principio del <strong>single writer</strong>: ciascun servizio produce gli eventi relativi al proprio dominio, diventando così la fonte di verità per quell’ambito e semplificando la gestione della consistenza e della tracciabilità degli stati nel sistema.</p>
</div>
<div class="paragraph">
<p>Per la definizione e l’evoluzione degli eventi, sono stati adottati Apache Avro e Confluent Schema Registry, così che ogni evento scambiato su Kafka rispetti uno schema esplicito e condiviso, mantenendo compatibilità tra servizi anche in caso di evoluzione futura dei dati. L’approccio garantisce che producer e consumer siano sempre allineati sul significato e la struttura delle informazioni trasmesse.</p>
</div>
<div class="paragraph">
<p>Dal punto di vista della struttura interna, ogni microservizio segue un ciclo preciso: riceve eventi da Kafka, li elabora applicando la propria logica di business, aggiorna lo stato locale e, quando necessario, pubblica nuovi eventi verso gli altri servizi. Questo pattern permette a ciascun componente di essere autonomo ma coordinato con il resto del sistema, mantenendo basso l’accoppiamento tra le parti.</p>
</div>
<div class="paragraph">
<p>Vert.x è stato mantenuto come framework principale sia per la gestione delle API REST (sincrone), sia per health check, caricamento configurazioni tramite variabili d’ambiente, interazione con MongoDB e gestione dell’event bus interno di alcuni servizi. In questo modo si differenzia chiaramente il canale delle chiamate API (esterne/sincrone) dalla comunicazione asincrona (interna/eventi).</p>
</div>
<div class="paragraph">
<p>Per il monitoraggio del sistema è stata mantenuta l’integrazione con Prometheus, che consente di raccogliere metriche in tempo reale da tutti i microservizi e agevola l’analisi delle performance o l’individuazione di anomalie operative. Completano l’architettura l’API Gateway (punto di accesso centralizzato) e il Service Discovery (Eureka), che garantisce la registrazione e scoperta dinamica dei servizi all’interno del sistema distribuito.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dettaglio_dei_microservizi">2.2. Dettaglio dei microservizi</h3>
<div class="paragraph">
<p>Ogni microservizio è stato adattato a una logica event driven, definendo una serie di eventi di dominio gestiti nell&#8217;application layer.</p>
</div>
<div class="sect3">
<h4 id="_ebike_microservice">2.2.1. EBike Microservice</h4>
<div class="paragraph">
<p>Il microservizio EBike rappresenta un componente fondamentale nell&#8217;architettura event-driven complessiva, responsabile della gestione del ciclo di vita delle biciclette elettriche nel sistema.</p>
</div>
<div class="sect4">
<h5 id="_approccio_event_driven">Approccio Event-Driven</h5>
<div class="paragraph">
<p>Il microservizio implementa un approccio event-driven puro:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Stato persistente</strong>: Mantiene lo stato attuale delle e-bike nel repository MongoDB</p>
</li>
<li>
<p><strong>Comunicazione asincrona</strong>: Utilizza eventi per notificare altri servizi di cambiamenti di stato</p>
</li>
<li>
<p><strong>Reazioni agli eventi</strong>: Aggiorna lo stato delle e-bike in base agli eventi ricevuti dai noleggi</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questo approccio permette al servizio di mantenere una fonte di verità per lo stato delle e-bike, comunicando efficacemente ogni cambiamento agli altri microservizi interessati.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modello_a_eventi">Modello a Eventi</h5>
<div class="paragraph">
<p>Il microservizio utilizza diversi tipi di eventi immutabili:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EBikeCreateEvent</code>: Segnala l&#8217;aggiunta di una nuova e-bike al sistema</p>
</li>
<li>
<p><code>EBikeUpdateEvent</code>: Notifica cambiamenti nello stato di un&#8217;e-bike esistente</p>
</li>
<li>
<p><code>EBikeRechargeEvent</code>: Comunica la richiesta di ricarica di una specifica e-bike</p>
</li>
<li>
<p><code>RequestEBikeUpdateEvent</code>: Trasporta richieste di aggiornamento dei dati di un&#8217;e-bike</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tutti gli eventi implementano l&#8217;interfaccia <code>Event</code> e sono definiti come <code>record</code> Java immutabili, garantendo integrità e consistenza nei dati trasmessi.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_di_comunicazione">Adapter di Comunicazione</h5>
<div class="paragraph">
<p>Il microservizio espone due modalità di interazione:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>API REST (sincrone)</strong> tramite <code>RESTEBikeAdapter</code> che espone endpoint per:</p>
<div class="ulist">
<ul>
<li>
<p>Creazione di e-bike (<code>POST /api/ebikes/create</code>)</p>
</li>
<li>
<p>Ricarica di e-bike (<code>PUT /api/ebikes/:id/recharge</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Comunicazione asincrona con Kafka</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer</strong>: Tramite <code>MapEventConsumer</code> che ascolta gli eventi <code>RideUpdateEventAvro</code> dal topic "ride-events"</p>
</li>
<li>
<p><strong>Producer</strong>: Pubblica eventi di aggiornamento attraverso <code>EbikeUpdatesProducer</code> sul topic "ebike-events"</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_flusso_operativo">Flusso Operativo</h5>
<div class="paragraph">
<p>Per ogni operazione, il microservizio:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ricezione input</strong>: Tramite REST o eventi Kafka</p>
</li>
<li>
<p><strong>Elaborazione</strong>: <code>EBikeServiceImpl</code> processa le richieste applicando la logica di business</p>
</li>
<li>
<p><strong>Persistenza</strong>: Lo stato attuale delle e-bike viene mantenuto nel repository</p>
</li>
<li>
<p><strong>Pubblicazione eventi</strong>: Dopo ogni cambiamento di stato, viene pubblicato un <code>EBikeUpdateEvent</code> su Kafka per informare gli altri servizi</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All&#8217;avvio, il servizio carica tutte le e-bike dal repository e pubblica eventi di aggiornamento per sincronizzare gli altri componenti del sistema.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_microservice">2.2.2. User Microservice</h4>
<div class="paragraph">
<p>Il microservizio User rappresenta un&#8217;implementazione completa del pattern Event Sourcing all&#8217;interno dell&#8217;architettura, gestendo tutte le informazioni e le operazioni relative agli utenti del sistema.</p>
</div>
<div class="sect4">
<h5 id="_event_sourcing_implementation">Event Sourcing Implementation</h5>
<div class="paragraph">
<p>A differenza del microservizio EBike, che utilizza un approccio event-driven ma mantiene lo stato corrente, il microservizio User adotta pienamente il pattern Event Sourcing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Persistenza eventi</strong>: Ogni modifica allo stato di un utente viene salvata come evento immutabile nell&#8217;event store (MongoDB)</p>
</li>
<li>
<p><strong>Ricostruzione stato</strong>: Lo stato corrente di un utente non è mai salvato direttamente, ma viene sempre ricostruito dalla sequenza degli eventi storici</p>
</li>
<li>
<p><strong>Completa tracciabilità</strong>: La cronologia completa di ogni utente è disponibile per audit, debugging e analisi</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il metodo <code>rebuildUserState</code> in <code>UserServiceImpl</code> è il cuore dell&#8217;implementazione, ricostruendo lo stato attuale dell&#8217;utente processando in sequenza temporale tutti gli eventi associati. Nello specifico è stato scelto di integrare event-sourcing in questo microservizio pechè, in un contesto reale, gestisce il credito utente, è quindi utile tenere una traccia temporale delle modifiche di credito del singolo utente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modello_a_eventi_2">Modello a Eventi</h5>
<div class="paragraph">
<p>Il microservizio utilizza diversi tipi di eventi immutabili:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UserCreatedEvent</code>: Registra la creazione di un nuovo utente nel sistema</p>
</li>
<li>
<p><code>UserSignInEvent</code>: Traccia gli accessi degli utenti</p>
</li>
<li>
<p><code>UserUpdateEvent</code>: Cattura modifiche allo stato dell&#8217;utente (tipo, credito)</p>
</li>
<li>
<p><code>RechargeCreditEvent</code>: Registra le operazioni di ricarica del credito</p>
</li>
<li>
<p><code>RequestUserUpdateEvent</code>: Veicola richieste di aggiornamento provenienti da altri servizi</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tutti gli eventi implementano l&#8217;interfaccia <code>Event</code> e sono definiti come <code>record</code> Java, garantendo immutabilità e consistenza.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_di_comunicazione_2">Adapter di Comunicazione</h5>
<div class="paragraph">
<p>Il microservizio espone due modalità di interazione:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>API REST (sincrone)</strong> tramite <code>RESTUserAdapter</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Registrazione utente (<code>POST /api/users/signup</code>)</p>
</li>
<li>
<p>Accesso utente (<code>POST /api/users/signin</code>)</p>
</li>
<li>
<p>Ricarica credito (<code>PATCH /api/users/:username/recharge</code>)</p>
</li>
<li>
<p>Osservazione utenti tramite WebSocket (<code>/observeAllUsers</code>, <code>/observeUser/:username</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Comunicazione asincrona con Kafka</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer</strong>: <code>MapEventConsumer</code> ascolta il topic "ride-events" per aggiornare il credito degli utenti</p>
</li>
<li>
<p><strong>Producer</strong>: Pubblica eventi di aggiornamento attraverso <code>UserUpdatesProducer</code> sul topic "user-events"</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_flusso_event_sourcing">Flusso Event Sourcing</h5>
<div class="paragraph">
<p>Per ogni operazione, il microservizio:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ricezione input</strong>: Da API REST o eventi Kafka</p>
</li>
<li>
<p><strong>Recupero eventi</strong>: Ottiene tutti gli eventi storici relativi all&#8217;utente</p>
</li>
<li>
<p><strong>Ricostruzione stato</strong>: Applica sequenzialmente gli eventi per ottenere lo stato corrente</p>
</li>
<li>
<p><strong>Valutazione comando</strong>: Verifica la fattibilità dell&#8217;operazione richiesta</p>
</li>
<li>
<p><strong>Generazione evento</strong>: Crea un nuovo evento che rappresenta l&#8217;operazione</p>
</li>
<li>
<p><strong>Persistenza evento</strong>: Salva l&#8217;evento nell&#8217;event store</p>
</li>
<li>
<p><strong>Pubblicazione</strong>: Notifica altri servizi tramite Kafka e WebSocket</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Questo approccio garantisce consistenza, tracciabilità completa e la possibilità di "time travel" attraverso la storia di ogni utente.</p>
</div>
<div class="paragraph">
<p>All&#8217;avvio, il servizio ricostruisce lo stato di tutti gli utenti dai loro eventi e pubblica eventi di aggiornamento per sincronizzare gli altri microservizi.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ride_microservice">2.2.3. Ride Microservice</h4>
<div class="paragraph">
<p>Il microservizio Ride rappresenta un componente fondamentale nell&#8217;architettura event-driven complessiva, responsabile della gestione del noleggio di e-bike da parte degli utenti e della simulazione in tempo reale delle corse.</p>
</div>
<div class="sect4">
<h5 id="_approccio_a_proiezioni_locali">Approccio a Proiezioni Locali</h5>
<div class="paragraph">
<p>Il microservizio implementa un approccio che combina elementi event-driven con proiezioni locali:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Event-driven</strong>: Utilizza eventi per comunicare con altri servizi e gestire il ciclo di vita delle ride</p>
</li>
<li>
<p><strong>Proiezioni locali</strong>: Mantiene copie locali degli stati di utenti ed e-bike attraverso il <code>LocalProjectionRepository</code></p>
</li>
<li>
<p><strong>Simulazione eventi</strong>: Genera eventi in tempo reale durante il noleggio tramite <code>RideSimulation</code> e <code>EventPublisher</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questo approccio permette al servizio di reagire rapidamente alle richieste degli utenti senza dover interrogare continuamente gli altri microservizi, mantenendo una cache locale degli stati più recenti ricostruiti dagli eventi ricevuti.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modello_a_eventi_3">Modello a Eventi</h5>
<div class="paragraph">
<p>Il microservizio utilizza diversi tipi di eventi immutabili:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RideStartEvent</code>: Registra l&#8217;inizio di un noleggio, associando un utente a una e-bike</p>
</li>
<li>
<p><code>RideStopEvent</code>: Segnala la conclusione di un noleggio, liberando l&#8217;e-bike</p>
</li>
<li>
<p><code>RideUpdateEvent</code>: Comunica aggiornamenti continui durante la simulazione (posizione, batteria, credito)</p>
</li>
<li>
<p><code>RequestRideEndEvent</code>: Veicola richieste di terminazione anticipata di un noleggio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parallelamente, il servizio consuma e memorizza eventi provenienti da altri domini:
* <code>UserUpdateEvent</code>: Eventi relativi agli utenti ricevuti dal topic "user-events"
* <code>EBikeUpdateEvent</code>: Eventi relativi alle e-bike ricevuti dal topic "ebike-events"</p>
</div>
<div class="paragraph">
<p>Tutti gli eventi sono implementati come <code>record</code> Java immutabili, garantendo integrità e tracciabilità delle operazioni.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_di_comunicazione_3">Adapter di Comunicazione</h5>
<div class="paragraph">
<p>Il microservizio espone due modalità di interazione:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>API REST (sincrone)</strong> tramite <code>RideServiceVerticle</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Avvio noleggio (<code>POST /startRide</code>)</p>
</li>
<li>
<p>Terminazione noleggio (<code>POST /stopRide</code>)</p>
</li>
<li>
<p>Health check (<code>GET /health</code>) e metriche (<code>GET /metrics</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Comunicazione asincrona con Kafka</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer</strong>: Riceve aggiornamenti sugli utenti e le e-bike tramite <code>ProjectionUpdatesConsumer</code></p>
</li>
<li>
<p><strong>Producer</strong>: Pubblica eventi di noleggio attraverso <code>RideEventsProducer</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_flusso_operativo_2">Flusso Operativo</h5>
<div class="paragraph">
<p>Il flusso di lavoro del servizio segue questo pattern:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ricezione richiesta</strong>: Tramite REST o eventi</p>
</li>
<li>
<p><strong>Consultazione proiezioni</strong>: Verifica dello stato attuale di utenti ed e-bike dalle proiezioni locali</p>
</li>
<li>
<p><strong>Validazione business rules</strong>: Controllo di disponibilità dell&#8217;e-bike, credito sufficiente e livello batteria</p>
</li>
<li>
<p><strong>Creazione noleggio</strong>: Inizializzazione di un oggetto <code>Ride</code> e avvio della simulazione</p>
</li>
<li>
<p><strong>Pubblicazione eventi</strong>: Notifica agli altri servizi tramite eventi Kafka</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La simulazione di una corsa, come nell&#8217;implementazione base:
* Aggiorna continuamente la posizione dell&#8217;e-bike secondo un algoritmo di movimento
* Riduce progressivamente il credito dell&#8217;utente e la batteria dell&#8217;e-bike
* Pubblica eventi <code>RideUpdateEvent</code> ad ogni aggiornamento tramite <code>EventPublisher</code>
* Termina automaticamente quando la batteria o il credito raggiungono zero</p>
</div>
<div class="paragraph">
<p>All&#8217;avvio, il servizio si registra con Eureka per il service discovery e inizia ad ascoltare gli eventi da Kafka, costruendo progressivamente le sue proiezioni locali per utenti ed e-bike.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_microservice">2.2.4. Map Microservice</h4>
<div class="paragraph">
<p>Il microservizio Map, già presente nella precedente versione dell&#8217;architettura, ha richiesto solo adattamenti minimali per integrarsi nel nuovo sistema event-driven. In particolare, è stato implementato il componente <code>MapEventConsumer</code> che permette al servizio di reagire in tempo reale agli eventi generati dagli altri microservizi.</p>
</div>
<div class="paragraph">
<p>Questo consumer si sottoscrive a due topic Kafka fondamentali:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ride-events: per tracciare inizio e fine dei noleggi</p>
</li>
<li>
<p>ebike-events: per aggiornare la posizione e lo stato delle biciclette</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quando riceve un evento, il consumer lo processa e direziona l&#8217;update alla web socket specifica.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scelte_architetturali_e_organizzazione_dei_topic_kafka">2.3. Scelte architetturali e organizzazione dei topic Kafka</h3>
<div class="paragraph">
<p>Nel disegno dei topic Kafka, si è seguito un criterio di coerenza con i bounded context del dominio, evitando topic troppo generici/specifici. Ogni topic è stato progettato per raccogliere eventi di una singola tipologia logica, in modo che i consumatori possano sottoscriversi solo ai flussi rilevanti e interpretare con chiarezza la semantica degli eventi ricevuti.</p>
</div>
<div class="paragraph">
<p>Nello specifico:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il topic <code>ride-events</code> veicola esclusivamente eventi relativi al ciclo di vita dei noleggi (inizio, aggiornamento, fine corsa).</p>
</li>
<li>
<p>Il topic <code>ebike-events</code> raccoglie eventi di aggiornamento delle biciclette elettriche.</p>
</li>
<li>
<p>Il topic <code>user-events</code> è dedicato agli aggiornamenti di stato degli utenti.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questa organizzazione dei topic facilita la <strong>gestione della single source of truth</strong> (ogni servizio produce eventi solo sul proprio topic di riferimento), consente la scalabilità indipendente dei consumer per ogni flusso e rende semplice evolvere gli schemi degli eventi con Avro senza impattare altri domini.</p>
</div>
<div class="sect3">
<h4 id="_flusso_di_propagazione_e_validazione_degli_eventi">2.3.1. Flusso di propagazione e validazione degli eventi</h4>
<div class="imageblock">
<div class="content">
<img src="resources/svg/SAP-ASS-3-topic-p1.drawio.svg" alt="Lista dei topic e interazione con microservizi" width="600">
</div>
<div class="title">Figure 1. Lista dei topic e definizione dei consumer/producer</div>
</div>
<div class="paragraph">
<p>Nel ciclo di vita di una corsa, i microservizi non comunicano tramite invocazioni dirette, ma esclusivamente attraverso eventi Kafka, mantenendo un disaccoppiamento logico tra le componenti.</p>
</div>
<div class="paragraph">
<p>Il microservizio Ride ha il compito di gestire la logica di simulazione della corsa: al momento dell&#8217;avvio (<code>startRide</code>) o durante l&#8217;esecuzione (<code>updateRide</code>), esso produce eventi (<code>RideStartedEvent</code>, <code>RideUpdateEvent</code>) che contengono informazioni come la bici utilizzata, l’utente coinvolto, la posizione, il tempo e i consumi stimati.</p>
</div>
<div class="paragraph">
<p>Tuttavia, questi eventi non modificano direttamente lo stato effettivo delle entità coinvolte (come la disponibilità di una bici o il credito di un utente). Invece, tali eventi vengono <strong>consumati dai microservizi EBike e User</strong>, che:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Valutano il contenuto dell’evento secondo le proprie regole di business (es. controllo sul credito residuo o sul livello di batteria),</p>
</li>
<li>
<p>Decidono autonomamente se accettare l’azione proposta,</p>
</li>
<li>
<p>E, solo in caso di esito positivo, producono un proprio evento (<code>EBikeUpdatedEvent</code>, <code>UserUpdatedEvent</code>) che rappresenta la modifica effettiva dello stato interno.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Questo meccanismo garantisce che ogni microservizio resti l’unico responsabile dello stato che gestisce, evitando conflitti e mantenendo la coerenza dei dati. Ad esempio:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>È <strong>EBikeService</strong>, e non Ride, a decidere se una bici può essere assegnata e a comunicarne la nuova disponibilità.</p>
</li>
<li>
<p>È <strong>UserService</strong>, e non Ride, a calcolare e registrare la diminuzione del credito utente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gli eventi <code>RideUpdateEvent</code> prodotti da Ride fungono quindi da <strong>richiesta</strong>, ma la modifica reale dello stato avviene solo in risposta alla validazione interna da parte del microservizio destinatario. In questo modo, la sincronizzazione dello stato tra i vari microservizi avviene in maniera affidabile, tracciabile e coerente.</p>
</div>
<div class="paragraph">
<p>I servizi di supporto come Map consumano infine gli eventi di aggiornamento (<code>ride-events</code>, <code>ebike-events</code>) per aggiornare le proiezioni grafiche o informative, senza avere alcuna autorità sui dati stessi, gli aggiornamenti relativi all&#8217;utente invece, vengono notificati alla gui tramite le web socket interne al microservizio user come da previa implementazione.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/svg/sequence-ride.svg" alt="Diagramma di sequenza che rappresenta il ciclo di eventi prodotti da una ride" width="600">
</div>
<div class="title">Figure 2. Diagramma di sequenza che rappresenta il ciclo di eventi prodotti da una ride</div>
</div>
<div class="sect4">
<h5 id="_serializzazione_e_validazione_degli_eventi_con_apache_avro_e_schema_registry">Serializzazione e validazione degli eventi con Apache Avro e Schema Registry</h5>
<div class="paragraph">
<p>All&#8217;interno del sistema, la serializzazione e la validazione degli eventi tra microservizi si basano sull&#8217;utilizzo congiunto di <strong>Apache Avro</strong> e <strong>Confluent Schema Registry</strong>. Questa combinazione consente di garantire messaggi binari compatti, schema-based, validati automaticamente sia lato producer che consumer.</p>
</div>
<div class="paragraph">
<p>Confluent Schema Registry è stato integrato nel sistema tramite container Docker dedicato, configurato all&#8217;interno del <code>docker-compose.yml</code> per comunicare con Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">schema-registry</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-schema-registry:7.9.1</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">${SCHEMA_REGISTRY_HOST_PORT}:8081"</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=PLAINTEXT://kafka:29092</span>
    <span class="pi">-</span> <span class="s">SCHEMA_REGISTRY_HOST_NAME=schema-registry</span>
    <span class="pi">-</span> <span class="s">SCHEMA_REGISTRY_LISTENERS=http://0.0.0.0:8081</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo Schema Registry mantiene un registro centralizzato di tutti gli schemi <code>.avsc</code> utilizzati nel sistema, assegnando a ciascuno un identificatore univoco. In questo modo, i messaggi Kafka trasportano solo l&#8217;ID dello schema e non l&#8217;intera definizione, ottimizzando le performance e garantendo la validazione automatica e la compatibilità evolutiva.</p>
</div>
<div class="paragraph">
<p>Gli eventi sono modellati come record Avro, che possono contenere campi primitivi oppure record annidati. Ogni producer riceve una serie di eventi di dominio, che successivamente vengono mappati in uno schema avro specifico e inviati. La definizione di uno schema tipico prevede:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il tipo principale <code>record</code></p>
</li>
<li>
<p>Un nome simbolico identificativo</p>
</li>
<li>
<p>Un namespace coerente con il dominio applicativo</p>
</li>
<li>
<p>Timestamp e UUID dell&#8217;evento</p>
</li>
<li>
<p>Un array di <code>fields</code>, ciascuno con nome e tipo</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Esempio generico di schema Avro</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SomeDomainEvent"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"events.avro"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payload"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Entity"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"status"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Questa struttura permette di definire eventi ricchi e auto-descrittivi, mantenendo un contratto formale tra i servizi che li scambiano.</p>
</div>
<div class="paragraph">
<p>In alcuni topic Kafka vengono trasmessi più tipi di eventi appartenenti a uno stesso dominio. Per gestirli con un unico schema, è stato adottato il pattern <strong>Union Type</strong> di Avro.</p>
</div>
<div class="paragraph">
<p>Si definisce un record contenitore che include un campo <code>payload</code>, il cui tipo è una unione di più tipi concreti.</p>
</div>
<div class="listingblock">
<div class="title">Esempio generico di schema Union</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DomainEventUnion"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"events.avro"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payload"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"events.avro.EventTypeA"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"events.avro.EventTypeB"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"events.avro.EventTypeC"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Questo approccio consente:
- di trasmettere più eventi logicamente affini in un singolo topic;
- di evitare la proliferazione di topic distinti;
- di mantenere coerenza e validazione schema-based.</p>
</div>
<div class="paragraph">
<p>Lato consumer, il record Avro ricevuto viene deserializzato come <code>GenericRecord</code>. Poiché il campo <code>payload</code> è una union, è necessario <strong>identificare il tipo specifico dell’evento ricevuto</strong> tramite il nome dello schema.</p>
</div>
<div class="paragraph">
<p>Il consumer può quindi applicare un filtro e processare solo i tipi rilevanti per il proprio dominio.</p>
</div>
<div class="listingblock">
<div class="title">Esempio generico di codice di consumo filtrato</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processEvent</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">GenericRecord</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">schemaName</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getSchema</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="s">"EventTypeB"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">schemaName</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Evento ignorato: {}"</span><span class="o">,</span> <span class="n">schemaName</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Elaborazione dell'evento di interesse</span>
    <span class="nc">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
    <span class="nc">GenericRecord</span> <span class="n">payload</span> <span class="o">=</span> <span class="o">(</span><span class="nc">GenericRecord</span><span class="o">)</span> <span class="n">event</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"payload"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">status</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"status"</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>

    <span class="c1">// Logica applicativa...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Questa tecnica permette di mantenere consumer generici, ma configurabili per gestire <strong>solo gli eventi significativi</strong>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_package_p_2_deployment_su_kubernetes">3. Package P-2: Deployment su Kubernetes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_obiettivo">3.1. Obiettivo</h3>
<div class="paragraph">
<p>Il secondo package dell&#8217;elaborato si concentra sul deployment dell&#8217;intera architettura progettata nel package P-1 su una infrastruttura distribuita basata su Kubernetes, sfruttando le funzionalità offerte dal framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="_strategia_di_deployment">3.2. Strategia di Deployment</h3>
<div class="paragraph">
<p>L&#8217;intero sistema è stato containerizzato e distribuito tramite oggetti Deployment, Service, ConfigMap e PersistentVolumeClaim definiti in manifesti YAML e orchestrati all&#8217;interno del namespace dedicato sap-assignment. La piattaforma di riferimento è Minikube, configurata con 4 CPU e 4 GB di RAM, che consente di testare l&#8217;infrastruttura in locale in un contesto realistico.</p>
</div>
</div>
<div class="sect2">
<h3 id="_componenti_infrastrutturali_distribuiti">3.3. Componenti Infrastrutturali Distribuiti</h3>
<div class="sect3">
<h4 id="_kafka_zookeeper">3.3.1. Kafka &amp; Zookeeper</h4>
<div class="paragraph">
<p>Il broker Kafka è gestito da un Deployment dedicato, accompagnato dal coordinatore Zookeeper. Entrambi i componenti utilizzano init container per attendere l&#8217;avvio dell&#8217;altro e assicurare la corretta sequenza di bootstrap.</p>
</div>
<div class="paragraph">
<p>Kafka espone sia porte interne (29092) che esterne (9092) e ha abilitato la creazione automatica dei topic</p>
</div>
<div class="paragraph">
<p>Zookeeper viene reso disponibile sulla porta 2181 tramite service ClusterIP</p>
</div>
</div>
<div class="sect3">
<h4 id="_schema_registry">3.3.2. Schema Registry</h4>
<div class="paragraph">
<p>Schema Registry di Confluent è deployato come microservizio separato e interfacciato con Kafka. La configurazione ne garantisce l&#8217;inizializzazione solo dopo la disponibilità del broker. Espone la porta 8081 ed è configurato per l&#8217;accesso in lettura/scrittura degli schemi Avro.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_ui">3.3.3. Kafka UI</h4>
<div class="paragraph">
<p>Per l&#8217;osservabilità e il debugging è stato incluso Kafka UI, configurato per comunicare con Kafka e Schema Registry. Espone la porta 8082 tramite un Service di tipo LoadBalancer per facilitarne l&#8217;accesso.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mongodb">3.3.4. MongoDB</h4>
<div class="paragraph">
<p>Il database MongoDB viene eseguito in un Deployment associato ad una PVC da 1Gi. Il volume persistente è utilizzato per conservare i dati utente, noleggi ed e-bike anche in caso di riavvio dei pod.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prometheus">3.3.5. Prometheus</h4>
<div class="paragraph">
<p>Per il monitoraggio dei microservizi, Prometheus è stato incluso e configurato con initContainers per attendere la disponibilità del gateway. Il servizio Prometheus espone la porta 9090 e può essere raggiunto esternamente tramite NodePort.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service_discovery_eureka">3.3.6. Service Discovery (Eureka)</h4>
<div class="paragraph">
<p>Il registro dei servizi Eureka viene eseguito in un Deployment separato e reso disponibile tramite service sulla porta 8761. I microservizi si registrano dinamicamente tramite configurazione centralizzata in ConfigMap.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_microservizi_applicativi">3.4. Microservizi Applicativi</h3>
<div class="paragraph">
<p>Tutti i microservizi del package P-1 (API Gateway, EBike, Ride, User, Map) sono deployati come Deployment Kubernetes con una replica ciascuno. Ogni servizio dispone di:</p>
</div>
<div class="paragraph">
<p>initContainers per assicurare il corretto ordine di avvio rispetto a dipendenze (Eureka, Kafka, MongoDB, ecc.)</p>
</div>
<div class="paragraph">
<p>readinessProbe e livenessProbe per supportare auto-riparazione e rolling update</p>
</div>
<div class="paragraph">
<p>Service di tipo ClusterIP per comunicazioni interne e per il load balancing interno tra pod</p>
</div>
<div class="paragraph">
<p>Tutti i microservizi sono accessibili unicamente tramite l&#8217;API Gateway, che espone un Service di tipo NodePort. In questo modo, il bilanciamento del carico tra le repliche dei microservizi avviene internamente grazie alla natura dei servizi ClusterIP, mentre l&#8217;accesso esterno avviene attraverso un singolo punto di ingresso centralizzato (API Gateway).</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurazione_centralizzata">3.5. Configurazione Centralizzata</h3>
<div class="paragraph">
<p>La configurazione di sistema è centralizzata in una ConfigMap denominata app-config, che contiene:</p>
</div>
<div class="paragraph">
<p>Informazioni su host e porte dei servizi</p>
</div>
<div class="paragraph">
<p>URL di connessione a Kafka, MongoDB, Eureka, Prometheus</p>
</div>
<div class="paragraph">
<p>Parametri runtime per microservizi</p>
</div>
<div class="paragraph">
<p>Tutti i container referenziano la ConfigMap per caricare dinamicamente le variabili d&#8217;ambiente.</p>
</div>
</div>
<div class="sect2">
<h3 id="_esecuzione_del_deployment">3.6. Esecuzione del Deployment</h3>
<div class="paragraph">
<p>L&#8217;intero processo di deploy viene automatizzato tramite uno script Bash (rebuild-minikube.sh), che:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ferma ed elimina eventuali istanze Minikube precedenti</p>
</li>
<li>
<p>Avvia una nuova istanza Minikube configurata con risorse adeguate</p>
</li>
<li>
<p>Costruisce localmente tutte le immagini Docker necessarie a partire dai Dockerfile nei microservizi</p>
</li>
<li>
<p>Crea il namespace sap-assignment</p>
</li>
<li>
<p>Applica in sequenza tutti i manifesti Kubernetes</p>
</li>
<li>
<p>Espone gli indirizzi IP e monitora lo stato dei pod</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="nb">echo</span> <span class="s2">"==== Destroying existing Minikube ===="</span>
minikube stop
minikube delete

<span class="nb">echo</span> <span class="s2">"==== Creating fresh Minikube instance ===="</span>
minikube start <span class="nt">--driver</span><span class="o">=</span>docker <span class="nt">--cpus</span><span class="o">=</span>4 <span class="nt">--memory</span><span class="o">=</span>4096

<span class="nb">echo</span> <span class="s2">"==== Setting up Docker environment for Minikube ===="</span>
<span class="nb">eval</span> <span class="si">$(</span>minikube docker-env<span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"==== Building Docker images ===="</span>
docker build <span class="nt">-t</span> eureka-server:latest <span class="nt">-f</span> ../p-1/microservices/service-discovery/Dockerfile ../p-1/microservices/service-discovery
docker build <span class="nt">-t</span> api-gateway:latest <span class="nt">-f</span> ../p-1/microservices/api-gateway/Dockerfile ../p-1/microservices/api-gateway
docker build <span class="nt">-t</span> user-microservice:latest <span class="nt">-f</span> ../p-1/microservices/user-microservice/Dockerfile ../p-1/microservices/user-microservice
docker build <span class="nt">-t</span> ebike-microservice:latest <span class="nt">-f</span> ../p-1/microservices/ebike-microservice/Dockerfile ../p-1/microservices/ebike-microservice
docker build <span class="nt">-t</span> map-microservice:latest <span class="nt">-f</span> ../p-1/microservices/map-microservice/Dockerfile ../p-1/microservices/map-microservice
docker build <span class="nt">-t</span> ride-microservice:latest <span class="nt">-f</span> ../p-1/microservices/ride-microservice/Dockerfile ../p-1/microservices/ride-microservice

<span class="nb">echo</span> <span class="s2">"==== Deploying to Kubernetes ===="</span>
<span class="nb">echo</span> <span class="s2">"Creating ConfigMap..."</span>
kubectl create ns sap-assignment
kubectl apply <span class="nt">-f</span> ./k8s/configMap.yaml
<span class="nb">echo</span> <span class="s2">"Deploying infrastructure..."</span>
kubectl apply <span class="nt">-f</span> ./k8s/kafka/zookeeper.yaml
kubectl apply <span class="nt">-f</span> ./k8s/kafka/kafka-broker-1.yaml
kubectl apply <span class="nt">-f</span> ./k8s/kafka/schema-registry.yaml
kubectl apply <span class="nt">-f</span> ./k8s/mongodb.yaml
kubectl apply <span class="nt">-f</span> ./k8s/prometheus.yaml
kubectl apply <span class="nt">-f</span> ./k8s/api-gateway.yaml
kubectl apply <span class="nt">-f</span> ./k8s/eureka-server.yml

<span class="nb">echo</span> <span class="s2">"Deploying services..."</span>
kubectl apply <span class="nt">-f</span> ./k8s/user-microservice.yaml
kubectl apply <span class="nt">-f</span> ./k8s/ebike-microservice.yaml
kubectl apply <span class="nt">-f</span> ./k8s/ride-microservice.yaml
kubectl apply <span class="nt">-f</span> ./k8s/map-microservice.yaml

<span class="nb">echo</span> <span class="s2">"Deploying Kafka UI"</span>
kubectl apply <span class="nt">-f</span> ./k8s/kafka/kafka-ui.yaml

<span class="nb">echo</span> <span class="s2">"==== Minikube IP address ===="</span>
minikube ip

<span class="nb">echo</span> <span class="s2">"==== Deployment complete. Checking status... ===="</span>
watch kubectl get pods <span class="nt">-n</span> sap-assignment</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accesso_al_sistema">3.7. Accesso al Sistema</h3>
<div class="paragraph">
<p>Una volta completato il deployment, l&#8217;accesso all&#8217;API Gateway avviene tramite il comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">kubectl port-forward <span class="nt">--address</span> 0.0.0.0 api-gateway- 8080:8080 <span class="nt">-n</span> sap-assignment</code></pre>
</div>
</div>
<div class="paragraph">
<p>Questo consente di esporre localmente l&#8217;applicazione per testare l&#8217;interazione tra microservizi e verificare i flussi di eventi.</p>
</div>
<div class="paragraph">
<p>All&#8217;interno del package è presente una copia del presentation layer del package p-1 per testare il funzionamento.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pipeline_di_lancio_completa">3.8. Pipeline di Lancio Completa</h3>
<div class="paragraph">
<p>Di seguito viene descritta la sequenza operativa per eseguire il deploy e l’avvio completo dell’applicazione, a partire dall’infrastruttura fino all’interfaccia utente.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Eseguire il deployment dell’infrastruttura</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>src/p-2/
./rebuild-minikube.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attendere che tutti i pod risultino in stato <code>Running</code> con tutti i container pronti (es. <code>1/1</code>, <code>2/2</code>, ecc.).</p>
</div>
</li>
<li>
<p><strong>Impostare il port forwarding per l’API Gateway</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">kubectl port-forward <span class="nt">--address</span> 0.0.0.0 deployment/api-gateway 8080:8080 <span class="nt">-n</span> sap-assignment</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lasciare aperto questo terminale durante l’utilizzo dell’applicazione.</p>
</div>
</li>
<li>
<p><strong>Avviare il presentation layer</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> ../presentation/
./gradlew run</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_package_p_3_introduzione_di_a_bike_station_e_digital_twin">4. Package P-3: Introduzione di A-Bike, Station e Digital Twin</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_estensione_del_domain_driven_design_a_bike_station_e_digital_twin">4.1. Estensione del Domain-Driven Design: A-Bike, Station e Digital Twin</h3>
<div class="paragraph">
<p>Per rispondere alle nuove richieste progettuali introdotte nella terza parte dell’elaborato, si è reso necessario estendere il Domain-Driven Design sviluppato nel progetto originale. In particolare, vengono introdotti i concetti di bicicletta autonoma (a-bike), stazione (station) e digital twin, al fine di supportare scenari avanzati di mobilità autonoma all’interno di un contesto smart city.</p>
</div>
<div class="sect3">
<h4 id="_obiettivi_e_requisiti_dellestensione">4.1.1. Obiettivi e requisiti dell&#8217;estensione</h4>
<div class="paragraph">
<p>Gli obiettivi definiti dall’elaborato sono i seguenti:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introdurre una nuova tipologia sperimentale di bicicletta, la <strong>a-bike</strong> (bicicletta autonoma), in grado di:</p>
<div class="ulist">
<ul>
<li>
<p>Raggiungere autonomamente la stazione più vicina dopo essere stata utilizzata;</p>
</li>
<li>
<p>Raggiungere autonomamente la posizione dell’utente che ne richiede il servizio.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Integrare le a-bike in un ambiente di smart city, sfruttando una componente di <strong>digital twin</strong> che:</p>
<div class="ulist">
<ul>
<li>
<p>Mantenga una rappresentazione virtuale aggiornata dello stato delle biciclette e delle stazioni;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_estensione_dellubiquitous_language">4.1.2. Estensione dell&#8217;Ubiquitous Language</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Termine</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-Bike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bicicletta elettrica autonoma, dotata di capacità di movimento automatico, in grado di raggiungere la stazione più vicina dopo l&#8217;utilizzo e di muoversi verso l’utente che ne richiede il servizio.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stazione</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Punto fisico all’interno della città dove le a-bike possono essere parcheggiate e ricaricate. Ogni stazione gestisce la propria capacità disponibile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital Twin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gemello digitale della città: una rappresentazione virtuale aggiornata in tempo reale di biciclette e stazioni che fornisce servizi di supporto e monitoraggio.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_requisiti_funzionali_estesi_per_a_bike_station_e_digital_twin">4.1.3. Requisiti Funzionali Estesi per A-Bike, Station e Digital Twin</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il sistema deve permettere agli utenti di richiedere una a-bike tramite l’interfaccia grafica, così che una bicicletta autonoma si diriga automaticamente verso la loro posizione.</p>
</li>
<li>
<p>Il sistema deve permettere agli utenti di annullare una richiesta di a-bike già inviata; in tal caso, la a-bike deve tornare autonomamente alla stazione più vicina disponibile.</p>
</li>
<li>
<p>Il sistema deve permettere agli utenti di visualizzare tramite l’interfaccia grafica tutte le stazioni e monitorarne la disponibilità in tempo reale.</p>
</li>
<li>
<p>Il sistema deve permettere agli utenti di seguire, sempre tramite interfaccia grafica, l’intero ciclo della a-bike richiesta, dalla partenza verso l’utente, durante la corsa e fino al ritorno in stazione.</p>
</li>
<li>
<p>Il sistema deve permettere alle a-bike di raggiungere autonomamente la stazione più vicina al termine di ogni corsa.</p>
</li>
<li>
<p>Il sistema deve permettere agli utenti amministratori di creare nuove stazioni all’interno dell’ambiente.</p>
</li>
<li>
<p>Il sistema deve permettere agli utenti amministratori di aggiungere nuove a-bike e di assegnarle a una stazione specifica.</p>
</li>
<li>
<p>Il sistema deve permettere alla componente Digital Twin di mantenere una vista aggiornata e coerente della posizione e dello stato di tutte le a-bike e delle stazioni.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_user_story">4.1.4. User Story</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">User Story</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US12: Richiesta A-Bike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un utente autenticato</p>
<p class="tableblock"><strong>When</strong> l’utente richiede una a-bike tramite l’interfaccia grafica</p>
<p class="tableblock"><strong>Then</strong> il sistema seleziona la a-bike disponibile più vicina e la fa muovere automaticamente verso la posizione dell’utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US13: Annullamento richiesta A-Bike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un utente che ha richiesto una a-bike</p>
<p class="tableblock"><strong>When</strong> l’utente annulla la richiesta prima che la corsa inizi</p>
<p class="tableblock"><strong>Then</strong> la a-bike torna autonomamente alla stazione più vicina disponibile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US14: Monitoraggio A-Bike e Stazioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un utente che ha richiesto una a-bike</p>
<p class="tableblock"><strong>When</strong> la a-bike è in movimento verso l’utente, durante la corsa, e al termine della stessa</p>
<p class="tableblock"><strong>Then</strong> l’utente può seguire graficamente su mappa lo spostamento della bici, la corsa e il ritorno in stazione, e può visualizzare lo stato e la disponibilità delle stazioni in tempo reale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US15: Docking Automatico</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> una a-bike che termina una corsa</p>
<p class="tableblock"><strong>When</strong> la corsa viene conclusa</p>
<p class="tableblock"><strong>Then</strong> la a-bike si dirige e parcheggia autonomamente presso la stazione più vicina con slot disponibile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US16: Creazione Stazione (Admin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un utente amministratore</p>
<p class="tableblock"><strong>When</strong> l’amministratore accede alla sezione di gestione delle stazioni</p>
<p class="tableblock"><strong>Then</strong> può creare una nuova stazione indicando posizione e capacità</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US17: Aggiunta A-Bike (Admin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un utente amministratore</p>
<p class="tableblock"><strong>When</strong> l’amministratore accede alla sezione di gestione delle a-bike</p>
<p class="tableblock"><strong>Then</strong> può aggiungere una nuova a-bike e assegnarla a una stazione specifica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US18: Monitoraggio tramite Digital Twin (Admin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Given</strong> un amministratore</p>
<p class="tableblock"><strong>When</strong> accede all’interfaccia di Digital Twin</p>
<p class="tableblock"><strong>Then</strong> può visualizzare in tempo reale lo stato, la posizione e la disponibilità di tutte le a-bike e delle stazioni</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_use_case_diagrams">4.2. Use-Case diagrams</h3>
<div class="imageblock">
<div class="content">
<img src="resources/svg/usecase-user-sap.drawio.svg" alt="Use-case diagram relativo agli utenti" width="30%" height="30%">
</div>
<div class="title">Figure 3. Use-case diagram relativo agli utenti</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Richiedere a-bike</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente è autenticato e ha credito sufficiente; esiste almeno una a-bike disponibile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una a-bike viene inviata verso la posizione dell’utente; la richiesta è tracciata nel sistema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente seleziona “Richiedi a-bike” nell’interfaccia grafica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’utente seleziona l’opzione per richiedere una a-bike</p>
<p class="tableblock">. Il sistema individua la a-bike disponibile più vicina</p>
<p class="tableblock">. Il sistema comanda la a-bike a muoversi verso l’utente</p>
<p class="tableblock">. L’utente può monitorare lo stato della richiesta tramite la GUI</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annullare richiesta a-bike</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Esiste una richiesta di a-bike in corso non ancora conclusa</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La richiesta viene annullata; la a-bike torna autonomamente alla stazione più vicina disponibile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente seleziona “Annulla richiesta a-bike” nell’interfaccia grafica</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’utente seleziona l’opzione per annullare la richiesta di a-bike</p>
<p class="tableblock">. Il sistema riceve l’annullamento</p>
<p class="tableblock">. La a-bike interrompe il movimento verso l’utente (se non ancora arrivata)</p>
<p class="tableblock">. Il sistema comanda la a-bike a tornare alla stazione disponibile più vicina</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoraggio stazioni/a-bike via UI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente è autenticato</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente può visualizzare in tempo reale la posizione e la disponibilità delle stazioni e delle a-bike, e seguire lo stato della richiesta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’utente effettua il login al sistema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’utente effettua il login al sistema</p>
<p class="tableblock">. Il sistema mostra le stazioni, la disponibilità di slot e la posizione delle a-bike</p>
<p class="tableblock">. L’utente può seguire l’intero ciclo della a-bike richiesta (avvicinamento, corsa, ritorno in stazione)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggiunta stazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin è autenticato</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una nuova stazione è registrata nel sistema, visibile nella mappa e disponibile per l’assegnazione di a-bike</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin seleziona “Add stazione” nell’interfaccia di amministrazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’admin preme il pulsatne "Add stazione"</p>
<p class="tableblock">. Inserisce posizione, capacità e altri dettagli della stazione</p>
<p class="tableblock">. Il sistema salva la nuova stazione e la rende disponibile</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggiunta a-bike</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin è autenticato; esiste almeno una stazione a cui assegnare la nuova a-bike</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una nuova a-bike è aggiunta alla flotta ed è assegnata a una stazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin seleziona “Add a-bike” nell’interfaccia di amministrazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’admin preme il pulsante "add a-bike"</p>
<p class="tableblock">. Inserisce i dati della nuova a-bike</p>
<p class="tableblock">. Seleziona la stazione di assegnazione</p>
<p class="tableblock">. Il sistema salva la nuova a-bike associandola alla stazione scelta</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoraggio stazioni/a-bike via Digital Twin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin è autenticato</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin può visualizzare in tempo reale la posizione, lo stato e la disponibilità di tutte le a-bike e delle stazioni tramite la piattaforma Digital Twin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L’admin accede alla dashboard Digital Twin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. L’admin apre la dashboard Digital Twin</p>
<p class="tableblock">. Il sistema mostra una vista aggiornata di tutte le stazioni e delle a-bike</p>
<p class="tableblock">. L’admin può filtrare, ricercare o analizzare lo stato delle risorse</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="resources/svg/usecase-system-sap.drawio.svg" alt="Use-case diagram relativo alle automazioni di sistema" width="30%" height="30%">
</div>
<div class="title">Figure 4. Use-case diagram relativo alle automazioni di sistema</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-bike movimento autonomo verso utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sistema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City – Automazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Il sistema ha ricevuto una richiesta valida di a-bike da parte di un utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La a-bike si muove autonomamente verso la posizione dell’utente e aggiorna il suo stato durante il percorso</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Il sistema riceve il comando di muovere la a-bike verso l’utente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. Il sistema individua la posizione dell’utente</p>
<p class="tableblock">. Calcola il percorso ottimale</p>
<p class="tableblock">. Comanda la a-bike a spostarsi autonomamente verso l’utente</p>
<p class="tableblock">. Aggiorna in tempo reale la posizione della a-bike</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Campo</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-bike docking autonomo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attori</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sistema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicazione Smart City – Automazione</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Livello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La corsa con la a-bike è terminata, oppure la richiesta è stata annullata</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postcondizioni</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La a-bike si dirige autonomamente verso la stazione più vicina con slot disponibile e aggiorna il proprio stato</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Termine corsa o annullamento richiesta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flusso</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">. Il sistema rileva la necessità di docking automatico</p>
<p class="tableblock">. Calcola la stazione più vicina disponibile</p>
<p class="tableblock">. Comanda la a-bike a dirigersi autonomamente verso la stazione</p>
<p class="tableblock">. Aggiorna la disponibilità della stazione e la posizione della a-bike</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_domain_storytelling">4.3. Domain storytelling</h3>
<div class="imageblock">
<div class="content">
<img src="resources/svg/A-bike%20request_2025-07-07.egn%20(4).svg" alt="domain storytelling" width="600">
</div>
</div>
<div class="exampleblock text-center">
<div class="content">
<div class="paragraph">
<p><strong>Domain Storytelling – Flusso utente per l’utilizzo di una a-bike autonoma</strong>:
Il diagramma rappresenta il percorso tipico di un utente che richiede una a-bike, dal momento della richiesta fino alla conclusione della corsa. Mostra come il sistema individua la stazione più vicina, sgancia la bici, gestisce il movimento autonomo verso l’utente e il ritorno automatico della bici alla stazione al termine della ride o in caso di annullamento.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bounded_context">4.4. Bounded Context</h3>
<div class="paragraph">
<p>In seguito all’estensione del sistema per supportare le biciclette autonome e la componente Digital Twin, sono stati individuati i seguenti nuovi bounded context:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bounded Context</th>
<th class="tableblock halign-left valign-top">Descrizione</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Station Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gestisce le stazioni di parcheggio e ricarica per abike. Mantiene lo stato, la capacità e la disponibilità delle stazioni. Gestisce tutte le operazioni di docking e undocking delle bici e pubblica eventi di aggiornamento ufficiali relativi alle stazioni.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ABike Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rappresenta il dominio delle biciclette autonome (a-bike). Gestisce il ciclo di vita, il movimento automatico (verso stazione o utente). Mantiene una proiezione locale delle stazioni per ottimizzare le decisioni di mobilità, ma delega sempre la validazione delle operazioni critiche (ad es. undocking) a Station Management.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Digital Twin Integration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adatta e traduce gli eventi di aggiornamento provenienti da ABike Management e Station Management verso la piattaforma Digital Twin (es. Eclipse Ditto), mantenendo una vista digitale e aggiornata della situazione reale del sistema. Questo context funge da adattatore e sincronizzatore tra il sistema event-driven e l’ambiente smart city virtuale.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_domain_model">4.5. Domain model</h3>
<div class="paragraph">
<p>In seguito verranno definiti i domain model dei tre context individuati</p>
</div>
<div class="sect3">
<h4 id="_station_management">4.5.1. Station Management</h4>
<div class="paragraph">
<p><strong>Aggregate Root:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Station</em>: Rappresenta una stazione fisica dove le a-bike possono essere parcheggiate e ricaricate. Gestisce la propria capacità e mantiene traccia delle biciclette attualmente ancorate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Value Objects:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>P2d</em>: Rappresenta un punto bidimensionale (x,y) che definisce la posizione geografica di una stazione.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Domain Events:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>BikeDockedEvent</em>: Generato quando una a-bike viene ancorata con successo a una stazione.</p>
</li>
<li>
<p><em>BikeReleasedEvent</em>: Generato quando una a-bike viene rilasciata da una stazione.</p>
</li>
<li>
<p><em>CreateStationEvent</em>: Generato quando una nuova stazione viene creata nel sistema.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Repository:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>StationRepository</em>: Gestisce la persistenza delle stazioni</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_abike_management">4.5.2. ABike Management</h4>
<div class="paragraph">
<p><strong>Aggregate Root:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ABike</em>: Rappresenta una bicicletta autonoma con capacità di movimento senza conducente. Mantiene informazioni sulla posizione, livello batteria e stato operativo corrente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Value Objects:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>P2d</em>: Rappresenta un punto bidimensionale (x,y) utilizzato per la posizione della bicicletta.</p>
</li>
<li>
<p><em>ABikeState</em>: Enumeration che definisce gli stati possibili di una a-bike: AVAILABLE (disponibile), AUTONOMOUS_MOVING (in movimento autonomo), IN_USE (in utilizzo), MAINTENANCE (in manutenzione).</p>
</li>
<li>
<p><em>Purpose</em>: Enumeration che definisce lo scopo di un movimento autonomo: TO_USER (verso l&#8217;utente) o TO_STATION (verso una stazione).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Entities:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Destination</em>: Rappresenta una destinazione con posizione e identificativo, può essere un utente o una stazione.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Domain Services:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Simulation</em>: Servizio di dominio che gestisce il movimento autonomo di una a-bike verso una destinazione. Calcola il percorso, aggiorna la posizione e notifica eventi di posizione fino al raggiungimento della meta.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Domain Events:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ABikeCreateEvent</em>: Generato quando una nuova a-bike viene creata nel sistema.</p>
</li>
<li>
<p><em>ABikeUpdate</em>: Generato quando le proprietà di una a-bike vengono aggiornate (posizione, stato, ecc.).</p>
</li>
<li>
<p><em>ABikeArrivedToUser</em>: Generato quando una a-bike raggiunge con successo un utente.</p>
</li>
<li>
<p><em>ABikeArrivedToStation</em>: Generato quando una a-bike raggiunge con successo una stazione.</p>
</li>
<li>
<p><em>CallAbikeEvent</em>: Generato quando un utente richiede una a-bike.</p>
</li>
<li>
<p><em>CancellCallRequest</em>: Generato quando un utente annulla una richiesta di a-bike.</p>
</li>
<li>
<p><em>ABikeCallComplete</em>: Generato quando una richiesta di a-bike viene completata.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Repository:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SimulationRepository</em>: Gestisce la persistenza delle simulazioni di movimento autonomo</p>
</li>
<li>
<p><em>ABikeRepository</em>: Gestisce la persistenza delle abike</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Aggregate Projections:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ABike</em>: Rappresentazione locale dell&#8217;aggregato ABike, contenente identificativo, posizione, livello batteria e stato operativo.</p>
</li>
<li>
<p><em>Station</em>: Rappresentazione locale dell&#8217;aggregato Station, con informazioni su posizione, capacità e biciclette attualmente ancorate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Value Objects:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Location</em>: Rappresenta un punto bidimensionale (x,y) utilizzato per definire la posizione di a-bike e stazioni.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Domain Events:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ABikeUpdateEvent</em>: Evento che trasporta aggiornamenti relativi a una a-bike, incluso il suo stato completo.</p>
</li>
<li>
<p><em>StationUpdateEvent</em>: Evento che trasporta aggiornamenti relativi a una stazione, incluso il suo stato completo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Domain Services:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>DittoTranslatorService</em>: Servizio core che gestisce la traduzione degli eventi di dominio in messaggi compatibili con Eclipse Ditto. Mantiene uno stato dei "thingId" già noti per ottimizzare le comunicazioni.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Factory:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>DittoEventFactory</em>: Factory specializzata nella creazione di messaggi nel formato richiesto da Ditto, sia per la creazione che per l&#8217;aggiornamento di entità.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementazione_dei_microservizi">4.6. Implementazione dei microservizi</h3>
<div class="sect3">
<h4 id="_station_microservice">4.6.1. Station Microservice</h4>
<div class="sect4">
<h5 id="_approccio_event_driven_e_gestione_del_dominio">Approccio Event-Driven e gestione del dominio</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Event-Driven</strong>: La comunicazione con altri microservizi avviene esclusivamente tramite eventi Kafka e, per le operazioni amministrative, tramite API REST.</p>
</li>
<li>
<p><strong>Gestione dello stato</strong>: Lo stato di ciascuna stazione (posizione, capacità, biciclette attraccate) è mantenuto in modo persistente e aggiornato tramite eventi, con la validazione locale di tutte le operazioni critiche (docking/undocking).</p>
</li>
<li>
<p><strong>Integrazione proiezioni</strong>: Il servizio mantiene la fonte di verità riguardo la disponibilità delle stazioni, pubblicando update ufficiali verso altri context e microservizi che mantengono proiezioni locali.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_modello_a_eventi_4">Modello a Eventi</h5>
<div class="paragraph">
<p>Il microservizio produce e consuma diversi eventi di dominio:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>StationRegisteredEvent</code>: Emesso quando viene creata una nuova stazione.</p>
</li>
<li>
<p><code>StationUpdateEvent</code>: Pubblicato dopo ogni aggiornamento di stato (docking/undocking di una bici).</p>
</li>
<li>
<p><code>BikeDockedEvent</code>: Consumato per gestire l’attracco di una bici a una stazione.</p>
</li>
<li>
<p><code>BikeReleasedEvent</code>: Consumato per gestire il rilascio (undocking) di una bici da una stazione.</p>
</li>
<li>
<p><code>CreateStationEvent</code>: Consumato quando si richiede la creazione di una nuova stazione (es. da API REST).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tutti gli eventi sono implementati come <code>record</code> Java immutabili, garantendo tracciabilità, integrità e auditabilità delle operazioni.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_di_comunicazione_4">Adapter di Comunicazione</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>API REST (sincrone)</strong> tramite <code>RESTStationAdapter</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Creazione di nuove stazioni (<code>POST /api/stations</code>)</p>
</li>
<li>
<p>Health check (<code>GET /health</code>)</p>
</li>
<li>
<p>Esposizione metriche (<code>GET /metrics</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Comunicazione asincrona con Kafka</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer</strong>: Ascolta il topic <code>"abike-events"</code> per ricevere richieste di docking/undocking da a-bike.</p>
</li>
<li>
<p><strong>Producer</strong>: Pubblica eventi di registrazione e aggiornamento su <code>"station-events"</code> per sincronizzare le proiezioni negli altri microservizi.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_flusso_operativo_3">Flusso Operativo</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Gestione creazione stazione</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Riceve richiesta REST o evento di creazione.</p>
</li>
<li>
<p>Valida e salva la nuova stazione.</p>
</li>
<li>
<p>Pubblica <code>StationRegisteredEvent</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Gestione docking/undocking</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Consuma eventi di docking/undocking da a-bike.</p>
</li>
<li>
<p>Valida l’operazione sullo stato locale.</p>
</li>
<li>
<p>Aggiorna lo stato della stazione e pubblica <code>StationUpdateEvent</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Inizializzazione</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>All’avvio, il servizio carica tutte le stazioni dal database e pubblica un evento per ciascuna, permettendo la sincronizzazione delle proiezioni negli altri context.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_persistenza_e_repository">Persistenza e Repository</h5>
<div class="paragraph">
<p>La persistenza delle stazioni è affidata a un repository MongoDB, implementato tramite <code>MongoRepository</code> che fornisce:
- Salvataggio e aggiornamento di entità Station.
- Recupero di tutte le stazioni.
- Mappatura tra documenti MongoDB e oggetti dominio (Station, P2d).</p>
</div>
<div class="paragraph">
<p>Il microservizio Station non accede direttamente ad altri bounded context, ma interagisce solo tramite eventi, mantenendo basso l’accoppiamento e assicurando la coerenza tramite la validazione locale delle operazioni di docking.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abike_microservice">4.6.2. ABike Microservice</h4>
<div class="paragraph">
<p>Il microservizio ABike costituisce il bounded context dedicato alla gestione delle biciclette autonome, orchestrando tutte le logiche di movimento automatico, assegnazione e stato delle a-bike nel sistema smart city.</p>
</div>
<div class="sect4">
<h5 id="_approccio_event_driven_e_gestione_del_dominio_2">Approccio Event-Driven e gestione del dominio</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Event-Driven</strong>: Tutta la logica di comunicazione con altri microservizi (Station, Ride, Map, ecc.) è basata su eventi pubblicati e consumati tramite Kafka, in particolare su topic come <code>"abike-events"</code>, <code>"station-events"</code> e <code>"ride-events"</code>.</p>
</li>
<li>
<p><strong>Proiezioni locali</strong>: Il servizio mantiene una proiezione locale delle stazioni per selezionare sempre la più vicina quando necessario (ad esempio, per il ritorno della bici in stazione o per la chiamata da parte di un utente).</p>
</li>
<li>
<p><strong>Movimento autonomo</strong>: Il movimento automatico delle a-bike (verso utente o stazione) è simulato da un servizio di dominio (<code>Simulation</code>) che aggiorna posizione e stato ogni tick, pubblicando gli eventi di avanzamento.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_modello_a_eventi_5">Modello a Eventi</h5>
<div class="paragraph">
<p>Il microservizio produce e consuma diversi eventi di dominio:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ABikeCreateEvent</code>: Segnala la creazione di una nuova a-bike nel sistema.</p>
</li>
<li>
<p><code>CallAbikeEvent</code>: Segnala la richiesta di una a-bike da parte di un utente (con destinazione utente).</p>
</li>
<li>
<p><code>ABikeRequested</code>: Evento di inizio movimento verso utente.</p>
</li>
<li>
<p><code>CancellCallRequest</code>: Segnala la cancellazione di una chiamata da parte dell’utente.</p>
</li>
<li>
<p><code>ABikeUpdate</code>: Aggiornamenti continui sullo stato e posizione della bici.</p>
</li>
<li>
<p><code>ABikeArrivedToUser</code>: Raggiungimento della destinazione utente.</p>
</li>
<li>
<p><code>ABikeArrivedToStation</code>: Raggiungimento di una stazione.</p>
</li>
<li>
<p><code>ABikeCallComplete</code>: Completamento del ciclo di chiamata.</p>
</li>
<li>
<p><code>RequestStationUpdate</code>: Sincronizzazione proiezioni di stazione.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tutti gli eventi sono implementati come <code>record</code> Java, garantendo immutabilità e tracciabilità.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_di_comunicazione_5">Adapter di Comunicazione</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>API REST (sincrone)</strong> tramite <code>RESTABikeAdapter</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Creazione di a-bike (<code>POST /api/abikes/create</code>)</p>
</li>
<li>
<p>Richiesta a-bike (<code>POST /api/callAbike</code>)</p>
</li>
<li>
<p>Annullamento richiesta (<code>POST /api/cancelCall</code>)</p>
</li>
<li>
<p>Health check e metriche</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Comunicazione asincrona con Kafka</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Producer</strong>: pubblica tutti gli eventi del ciclo di vita della a-bike su <code>"abike-events"</code>.</p>
</li>
<li>
<p><strong>Consumer</strong>: ascolta eventi da <code>"station-events"</code> (per mantenere aggiornata la proiezione locale delle stazioni) e da <code>"ride-events"</code> (per intercettare le richeiste di update dello stato delle a-bike durante una ride).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_flusso_operativo_4">Flusso Operativo</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Creazione a-bike</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Riceve richiesta REST e genera l&#8217;evento di dominio <code>ABikeCreateEvent</code>.</p>
</li>
<li>
<p>Recupera la posizione iniziale dalla stazione selezionata.</p>
</li>
<li>
<p>Crea la nuova a-bike (stato AVAILABLE), la salva e pubblica evento di creazione e update.
Una nuova a-bike diventa a tutti glie effetti disponibile se Station microservice approva il docking della a-bike nella stazione definita e rilascia uno <code>StationUpdateEvent</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Chiamata a-bike (callAbike)</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Riceve richiesta (REST/evento) con destinazione utente  <code>CallAbikeEvent</code>.</p>
</li>
<li>
<p>Seleziona la stazione più vicina con bici disponibile.</p>
</li>
<li>
<p>Pubblica gli eventi <code>AbikeRequested</code> e <code>CallAbikeEvent</code> per segnalare la richiesta di undock della a-bike a station e la richiesta di pagamento per la chiamata all' utente.</p>
</li>
<li>
<p>Assegna una a-bike e crea una nuova simulazione con <code>Purpose.TO_USER</code>, iniziando a generare update.</p>
</li>
<li>
<p>Aggiorna ciclicamente posizione e stato, pubblicando eventi di update <code>ABikeUpdate</code>.</p>
</li>
<li>
<p>Al termine, pubblica evento di arrivo (<code>ABikeArrivedToUser</code>).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Fine corsa e ritorno in stazione</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Al termine di una ride viene intercettato l&#8217;evento di stop.</p>
</li>
<li>
<p>Identifica la stazione più vicina con spazio disponibile.</p>
</li>
<li>
<p>Simula il movimento della bici verso la stazione (creando una nuova simulazione con <code>Purpose.TO_STATION</code>) e pubblica eventi di update e arrivo (<code>ABikeUpdate</code>, <code>ABikeArrivedToStation</code>).</p>
</li>
<li>
<p>Pubblica l&#8217;evento di completamento della call <code>ABikeCallComplete</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Annullamento richiesta</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Riceve richiesta di cancellazione (REST/evento <code>CancellCallRequest</code>).</p>
</li>
<li>
<p>Interrompe la simulazione in corso (se presente).</p>
</li>
<li>
<p>Avvia il ritorno automatico della bici alla stazione più vicina (nuova simulazione con <code>Purpose.TO_STATION</code>).</p>
</li>
<li>
<p>Al termine esegue la procedura standard di termine chiamata descritta al punto 3</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Proiezioni locali di stazione</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Sincronizza lo stato delle stazioni ascoltando eventi <code>"StationRegisteredEventAvro"</code> e <code>"StationUpdateEventAvro"</code> da Kafka, mantenendo aggiornata la lista interna.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_persistenza_e_repository_2">Persistenza e Repository</h5>
<div class="ulist">
<ul>
<li>
<p><strong>ABikeRepository</strong>: persistenza delle a-bike (posizione, stato, batteria).</p>
</li>
<li>
<p><strong>StationProjectionRepository</strong>: persistenza e aggiornamento delle proiezioni delle stazioni.</p>
</li>
<li>
<p><strong>SimulationRepository</strong>: gestione delle simulazioni attive per ogni a-bike.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ride_microservice_2">4.6.3. Ride Microservice</h4>
<div class="paragraph">
<p>Il microservizio Ride mantiene l’approccio event-driven descritto nella prima versione dell’architettura, ma è stato esteso e adattato per supportare la nuova tipologia di bicicletta autonoma (ABike) accanto alle EBike tradizionali.</p>
</div>
<div class="sect4">
<h5 id="_estensione_del_domain_model">Estensione del Domain Model</h5>
<div class="paragraph">
<p>Per astrarre la gestione di EBike e ABike, sono stati introdotti i seguenti elementi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Interfaccia Bike</strong>: rappresenta un contratto comune che consente al microservizio di gestire in modo generico le istanze di EBike e ABike nelle proiezioni locali.</p>
</li>
<li>
<p><strong>Classe ABike</strong>: aggiunta come implementazione di Bike, con i propri attributi specifici (in particolare, lo stato di movimento autonomo).</p>
</li>
<li>
<p><strong>Enum BikeState</strong>: ora contiene gli stati di EBike e ABike, consentendo di uniformare la gestione dello stato durante la simulazione e le ride.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Queste astrazioni permettono di utilizzare la stessa logica di proiezione, simulazione e verifica sia per ebike che per abike, mantenendo separata la gestione degli eventi specifici.</p>
</div>
</div>
<div class="sect4">
<h5 id="_eventi_di_dominio_aggiornati">Eventi di Dominio Aggiornati</h5>
<div class="paragraph">
<p>Gli eventi di dominio sono stati estesi come segue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Eventi comuni</strong>: <code>RideStartEvent</code>, <code>RideStopEvent</code>, <code>RequestRideEndEvent</code>, <code>UserUpdateEvent</code></p>
</li>
<li>
<p><strong>Eventi specifici EBike</strong>: <code>EBikeUpdateEvent</code>, <code>RideUpdateEBikeEvent</code></p>
</li>
<li>
<p><strong>Eventi specifici ABike</strong>: <code>ABikeUpdateEvent</code>, <code>RideUpdateABikeEvent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Per quanto riguarda gli eventi pubblicati sul topic Kafka, questi vengono ora completamente separati in base al tipo di bicicletta, come evidenziato dagli schemi Avro. Eventi di dominio generici come <code>RideStartEvent</code> e <code>RideStopEvent</code> sono stati differenziati a livello di adapter gestendoli con schemi Avro specifici per tipo di bike.</p>
</div>
</div>
<div class="sect4">
<h5 id="_proiezione_locale">Proiezione Locale</h5>
<div class="paragraph">
<p>Il microservizio mantiene proiezioni locali tramite il <code>LocalProjectionRepository</code>, che implementa il pattern Event Sourcing per:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Utenti</strong>: Tracciati in una mappa con chiave username, dove ogni elemento contiene una lista cronologica di <code>UserUpdateEvent</code>. Lo stato corrente dell&#8217;utente viene ricostruito recuperando l&#8217;evento più recente.</p>
</li>
<li>
<p><strong>Biciclette</strong>: Gestite attraverso l&#8217;interfaccia <code>Bike</code> che unifica il comportamento, ma memorizzate in una mappa con chiave composta (id + tipo) che distingue tra:</p>
<div class="ulist">
<ul>
<li>
<p><code>EBike</code>: Popolata tramite eventi <code>EBikeUpdateEvent</code></p>
</li>
<li>
<p><code>ABike</code>: Popolata tramite eventi <code>ABikeUpdateEvent</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ogni richiesta di informazioni su un&#8217;entità viene soddisfatta asincronamente (<code>CompletableFuture</code>), recuperando l&#8217;evento più recente dalla cronologia pertinente e ricostruendo lo stato corrente dell&#8217;oggetto di dominio.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_microservice_2">4.6.4. Map microservice</h4>
<div class="paragraph">
<p>Questo microservizio è stato adattato a processare anche i vari eventi generati da Station e ABike.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_microservice_2">4.6.5. User microservice</h4>
<div class="paragraph">
<p>Questo microservizio è stato adattato a processare <code>CallAbikeEvent</code> per decrementare il credito dell&#8217;utente che ha effettuato la chiamata.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_organizzazione_topic_kafka_e_nuovo_flusso_di_comunicazione">4.7. Organizzazione topic Kafka e nuovo flusso di comunicazione</h3>
<div class="paragraph">
<p>La logica di creazione dei topic di kafka rispetta la medesima del p-1 realizzando quindi due nuovi topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Il topic <code>abike-events</code> che veicola gli update relativi all&#8217;intero ciclo di vita di una abike.</p>
</li>
<li>
<p>Il topic <code>station-evetns</code> che veicola gli update relativi alle stazioni.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/svg/SAP-ASS-3-topic-p-3.drawio.svg" alt="Lista dei topic e interazione con microservizi" width="70%" height="70%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/svg/abike-sequence-event.svg" alt="Diagramma di sequenza che rappresenta il ciclo di eventi introdotti da a-bike" width="800">
</div>
<div class="title">Figure 5. Diagramma di sequenza che rappresenta il ciclo di eventi introdotti da a-bike</div>
</div>
<div class="paragraph">
<p>Il flusso di eventi non descritto nel diagramma è da considerarsi identico al punto p-1, visto che ride-microservice è stato reso generico dal punto di vista di una bike ed è stato adattato l&#8217;adapter consumer per processare nel modo corretto i nuovi eventi prodotti.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integrazione_eclipse_ditto_digital_twin_adapter">4.8. Integrazione Eclipse Ditto &amp; Digital Twin Adapter</h3>
<div class="paragraph">
<p>Per abilitare la sincronizzazione tra la flotta di a-bike/stazioni fisiche e la loro rappresentazione digitale in ambiente smart city, è stata integrata la piattaforma <strong>Eclipse Ditto</strong> come Digital Twin framework.</p>
</div>
<div class="sect3">
<h4 id="_architettura_e_orchestrazione">4.8.1. Architettura e orchestrazione</h4>
<div class="paragraph">
<p>L’infrastruttura include i servizi principali di Ditto (gateway, things, policies, connectivity, search, UI) deployati tramite Docker Compose insieme ai microservizi core. Tutte le componenti condividono una rete bridge dedicata per garantire isolamento e connettività diretta ai servizi Kafka e MongoDB condivisi.</p>
</div>
<div class="paragraph">
<p>Il Digital Twin si interfaccia con l’ecosistema event-driven tramite un microservizio denominato <strong>ditto-kafka-adapter</strong>, che svolge un ruolo di <strong>translator</strong> e <strong>bridge</strong> tra i topic Kafka (dove i microservizi pubblicano eventi di dominio serializzati con Avro) e le API di Ditto.</p>
</div>
</div>
<div class="sect3">
<h4 id="_flusso_dati_e_ruolo_del_microservizio_adapter">4.8.2. Flusso dati e ruolo del microservizio adapter</h4>
<div class="paragraph">
<p><strong>ditto-kafka-adapter</strong> svolge due ruoli principali:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ricezione eventi da Kafka</strong></p>
<div class="ulist">
<ul>
<li>
<p>Sottoscrive i topic Kafka <code>abike-events</code> e <code>station-events</code>.</p>
</li>
<li>
<p>Consuma in particolare eventi di tipo <code>ABikeUpdate</code> e <code>StationUpdateEvent</code> prodotti dai rispettivi microservizi.</p>
</li>
<li>
<p>Alla ricezione di questi eventi, converte i dati di dominio in <strong>comandi Ditto</strong> (formato JSON), rispettando le specifiche delle <strong>Ditto Things</strong> (gemelli digitali di a-bike e stazioni).</p>
</li>
<li>
<p>Gestisce in modo trasparente sia la creazione (comando "create") che l’aggiornamento periodico ("modify") dei gemelli digitali, pubblicando i messaggi su Kafka nel topic dedicato a Ditto <code>ditto-messages</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Gestione eventi di ritorno da Ditto</strong></p>
<div class="ulist">
<ul>
<li>
<p>Implementata (per scopi di test/estendibilità) la ricezione di eventi/risposte provenienti dal topic Kafka <code>ditto-commands</code>, normalmente prodotti da Ditto in seguito a modifiche o richieste verso i suoi gemelli digitali.</p>
</li>
<li>
<p>Il microservizio elabora questi messaggi, estrae identificativi, correlation-id e invia (tramite le API di Ditto o di nuovo via Kafka) eventuali risposte o conferme di avvenuta esecuzione, secondo lo standard Ditto.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_pipeline_operativa">4.8.3. Pipeline operativa</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Aggiornamento Digital Twin</strong></p>
<div class="ulist">
<ul>
<li>
<p>Ogni volta che un evento di aggiornamento (ad esempio una nuova posizione di una a-bike o lo stato di una stazione) viene emesso su Kafka, il <strong>ditto-kafka-adapter</strong> lo intercetta, lo converte e lo inoltra verso Ditto.</p>
</li>
<li>
<p>Se il gemello digitale della a-bike o della stazione non esiste ancora, il microservizio provvede automaticamente alla creazione, altrimenti effettua un update.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Ciclo completo di Digital Twin</strong></p>
<div class="ulist">
<ul>
<li>
<p>Tutte le modifiche di stato, posizione, batteria, capacità delle stazioni sono sincronizzate in near real-time tra la parte fisica (microservizi) e la rappresentazione digitale (Ditto Things).</p>
</li>
<li>
<p>È stata validata la possibilità di ricevere comandi/risposte da Ditto tramite Kafka, aprendo a scenari di controllo bidirezionale.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusioni">5. Conclusioni</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Questo assignment si è rivelato particolarmente interessante e formativo. Ho avuto la possibilità di mettere in pratica molti concetti affrontati durante il corso, ma soprattutto di approfondire tecnologie che non conoscevo o che avevo solo incontrato superficialmente, come Kafka, Avro ed Eclipse Ditto.</p>
</div>
<div class="paragraph">
<p>L’approccio event-driven mi ha permesso di comprendere in modo molto più chiaro e concreto i vantaggi dell’architettura a microservizi basata su eventi, sia dal punto di vista della scalabilità che della resilienza. La gestione delle comunicazioni tramite Kafka e la serializzazione con Avro sono state sfide inizialmente complesse, ma estremamente utili per rafforzare le mie competenze pratiche.</p>
</div>
<div class="paragraph">
<p>Inoltre, la parte di deployment su Kubernetes mi ha permesso di acquisire maggiore familiarità con l’orchestrazione di applicazioni containerizzate in ambienti simili al mondo reale.</p>
</div>
<div class="paragraph">
<p>Infine, è stato stimolante poter integrare la tematica dei Digital Twin tramite Eclipse Ditto.</p>
</div>
<div class="paragraph">
<p>In sintesi, considero questa esperienza una tappa importante per la mia crescita tecnica e una base solida per affrontare progetti di maggiore complessità in futuro.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-07-15 23:46:48 UTC
</div>
</div>
</body>
</html>